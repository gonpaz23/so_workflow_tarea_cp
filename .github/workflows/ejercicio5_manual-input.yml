name: Ejercicio 5 - Workflow Manual

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Entorno de despliegue'
        required: true
        default: 'staging'
        type: choice
        options:
          - development
          - staging
          - production
      version:
        description: 'Versi√≥n a desplegar'
        required: true
        default: '1.0.0'
      confirm:
        description: '¬øConfirmar despliegue?'
        type: boolean
        default: false

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    if: ${{ github.event.inputs.confirm == 'true' }}
    
    steps:
      - name: Mostrar par√°metros de entrada
        run: |
          echo "üéØ Entorno seleccionado: ${{ github.event.inputs.environment }}"
          echo "üî¢ Versi√≥n: ${{ github.event.inputs.version }}"
          echo "üë§ Ejecutado por: ${{ github.actor }}"
          echo "üìÖ Fecha de ejecuci√≥n: $(date)"
      
      - name: Preparar entorno simulado
        run: |
          echo "Preparando entorno de ${{ github.event.inputs.environment }}..."
          # Crear estructura de directorios seg√∫n entorno
          mkdir -p deploy-artifacts
          echo "Entorno: ${{ github.event.inputs.environment }}" > deploy-artifacts/config.txt
          echo "Versi√≥n: ${{ github.event.inputs.version }}" >> deploy-artifacts/config.txt
          echo "Timestamp: $(date)" >> deploy-artifacts/config.txt
      
      - name: Simular proceso de despliegue
        run: |
          echo "üöÄ Iniciando despliegue en ${{ github.event.inputs.environment }}..."
          echo "Versi√≥n: ${{ github.event.inputs.version }}"
          
          # Simular diferentes pasos seg√∫n el entorno
          if [[ "${{ github.event.inputs.environment }}" == "development" ]]; then
            echo "üîß Configurando entorno de desarrollo..."
            sleep 2
          elif [[ "${{ github.event.inputs.environment }}" == "staging" ]]; then
            echo "üß™ Ejecutando pruebas en staging..."
            sleep 3
          elif [[ "${{ github.event.inputs.environment }}" == "production" ]]; then
            echo "‚ö†Ô∏è  DESPLIEGUE EN PRODUCCI√ìN - Requiere confirmaci√≥n"
            sleep 5
          fi
          
          echo "‚úÖ Proceso de despliegue simulado completado!"
      
      - name: Generar reporte de despliegue
        run: |
          echo "üìä REPORTE DE DESPLIEGUE" > deploy-report.md
          echo "========================" >> deploy-report.md
          echo "" >> deploy-report.md
          echo "- **Entorno**: ${{ github.event.inputs.environment }}" >> deploy-report.md
          echo "- **Versi√≥n**: ${{ github.event.inputs.version }}" >> deploy-report.md
          echo "- **Estado**: COMPLETADO" >> deploy-report.md
          echo "- **Timestamp**: $(date)" >> deploy-report.md
          
          cat deploy-report.md
      
      - name: Notificaci√≥n final
        if: always()
        run: |
          if [[ "${{ job.status }}" == "success" ]]; then
            echo "‚úÖ Workflow '${{ github.workflow }}' completado exitosamente"
            echo "üìã Resumen:"
            echo "   Entorno: ${{ github.event.inputs.environment }}"
            echo "   Versi√≥n: ${{ github.event.inputs.version }}"
            echo "   Confirmado: ${{ github.event.inputs.confirm }}"
          else
            echo "‚ùå Workflow fall√≥ con estado: ${{ job.status }}"
          fi